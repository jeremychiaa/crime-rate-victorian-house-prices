---
title: "Data Wrangling (Data Preprocessing)"
author: "Jeremy Jian Zhi Chia"
subtitle: Practical assessment 2
date: "25/09/2021"
output:
  html_notebook: default
  pdf_document: default
  html_document:
    df_print: paged
---


## **Setup**

```{r}

# Load the necessary packages required to reproduce the report. For example:

library(kableExtra)
library(magrittr)
library(dplyr)
library(tidyr)
library(readr)
library(readxl)
library(openxlsx)
library(ggplot2)
library(tools)

```


## **Student names, numbers and percentage of contributions**
```{r, echo=FALSE}

# Add your names, numbers and percentage of your contribution here.

na<- c("Jeremy Jian Zhi Chia")
no<- c("s3917515")
pc<- c("100%")

s<- data.frame(cbind(na,no,pc))
colnames(s)<- c("Student name", "Student number", "Percentage of contribution")

s %>% kbl(caption = "Group information") %>%
  kable_classic(full_width = F, html_font = "Cambria")

```
<br>
<br>

## **Executive Summary**

In your own words, provide a brief summary of the preprocessing. Explain the steps that you have taken to preprocess your data. Write this section last after you have performed all data preprocessing. (Word count Max: 300 words)
You may use bulleted lists like this:

* a
* b
* ....

<br>
<br>

## **Data**
Source 1:
Data Vic (https://discover.data.vic.gov.au/dataset/victorian-property-sales-report-median-house-by-suburb)

Description:
This dataset lists the percentage shift in median prices between quarters as well as the change over a 12-month period for Victorian houses.

Variables:
Suburb - All suburbs in Victoria, Austraalia
Jul-Sep 19 - Median house prices for that period
Oct-Dec 19 - Median house prices for that period
Jan-Mar 20 - Median house prices for that period
Apr-Jun 20 - Median house prices for that period
Jul-Sep 20 - Median house prices for that period
No of Sales Jul-Sep 20 - Number of house sales for that period
No of Sales YTD - Year to date number of house sales
Change % Jul-Sep 19 Jul-Sep 19 - Percentage change in median house price between two periods
Change % Apr-Jun 20 Jul-Sep 20 - Percentage change in median house price between two periods

Source 2: Crime Statistics Agency (https://www.crimestatistics.vic.gov.au/crime-statistics/historical-crime-data/download-data-3)
Description: There are five tables within this excel workbook. 
The datasets of interest are chosen from these five tables:
- The crime rate by principal offence, LGA and police service area dataset
- Criminal incidents by LGA and suburb dataset
- Criminal incidents by charge status and LGA dataset

Variables:


```{r}

# Import the data, provide your R codes here.

# House median prices dataset
house_medians <- read_excel("data/House_Medians3rdQtr2020.xls", skip = 1)

# Crime rate by principal offence, LGA and police service area dataset
crime_rate <- read_excel("data/Data_Tables_LGA_Criminal_Incidents_Year_Ending_September_2020.xlsx%3F8rMGzuMnVt5oC9mV_AAn_dmq1tfyPo9T=.xlsx", 
    sheet = "Table 02")

# Criminal incidents by LGA and suburb dataset
criminal_incidents_lga_suburb <- read_excel("data/Data_Tables_LGA_Criminal_Incidents_Year_Ending_September_2020.xlsx%3F8rMGzuMnVt5oC9mV_AAn_dmq1tfyPo9T=.xlsx", 
    sheet = "Table 03")

# Criminal incidents by charge status and LGA
criminal_incidents_charge_status <- read_excel("data/Data_Tables_LGA_Criminal_Incidents_Year_Ending_September_2020.xlsx%3F8rMGzuMnVt5oC9mV_AAn_dmq1tfyPo9T=.xlsx", 
    sheet = "Table 05")

```

```{r}
# Creating a dataframe of suburbs and their respective LGAs
suburb_lga <- criminal_incidents_lga_suburb %>% select(`Suburb/Town Name`, `Local Government Area`) %>% unique
suburb_lga %>% head(10)
```
A dataframe of each suburbs and their corresponding LGAs are created using the criminal incidents by LGA and suburb dataset. This allows for identifying which LGA a particular suburb belong to.

```{r}
# Lowering and capitalising suburb names in House Median Prices dataset
house_medians$SUBURB <- house_medians$SUBURB %>% tolower() %>% tools::toTitleCase()
house_medians$SUBURB %>% head(10)
```
To allow for joining of the house median prices dataset with the Suburb-LGA dataset created above, the values of each containing the suburb names must match between the datasets. Therefore, they are converted from all uppercase to lowercase and title case.

```{r}
# Joining suburb and LGA dataframe with house median prices
house_medians <- house_medians %>% left_join(suburb_lga, by=c("SUBURB" = "Suburb/Town Name"))

# Rearranging variables within dataframe
house_medians <- house_medians[,c("SUBURB", "Local Government Area", "Jul - Sep 19", "Oct - Dec 19", "Jan - Mar 20", "Apr- Jun 20", "Jul - Sep 20", "No of sales Jul - Sep 20", "No of Sales YTD", "Change % Jul - Sep 19 Jul - Sep 20", "Change % Apr - Jun 20 Jul - Sep 20")]

house_medians %>% head(10)
```
The house median prices dataset and the suburb-LGA dataset are joined together. They are rearranged so that the Suburb and LGA columns are side-to-side.

```{r}
# Joining house median prices with criminal incidents by LGA and Suburb
house_medians_criminal_incidents <- house_medians %>% left_join(criminal_incidents_lga_suburb, by=c("SUBURB" = "Suburb/Town Name", "Local Government Area"))

house_medians_criminal_incidents %>% head()
```
The house median prices and suburb-LGA datasets are then joined with the criminal incidents by suburb/LGA dataset which shows various types of offences that occurred within that suburb at any given time period.

```{r}
# Joining house median criminal incidents df created above with criminal incidents charge status
house_medians_criminal_incidents <- house_medians_criminal_incidents %>% left_join(criminal_incidents_charge_status, by = c("Local Government Area", "Year", "Year ending"))

house_medians_criminal_incidents %>% head()
```
The criminal incidents by charge status is joined with the other datasets above. This dataset shows the charge statuses of the crime incidents and their recorded number of incidents by LGA. There are a total of four datasets that have been merged above. 

<br>
<br>

## **Understand** 
```{r}
# Inspect attributes
house_medians_criminal_incidents %>% attributes()
```
Upon inspecting of the attributes, some of the variables names can be renamed for improved clarity.

```{r}
# Renaming of columns
names(house_medians_criminal_incidents)[names(house_medians_criminal_incidents) == "SUBURB"] <- "Suburb"

# Checking new column names
house_medians_criminal_incidents %>% colnames()
```

```{r}
# Inspect structure of dataset
house_medians_criminal_incidents %>% str()
```
Upon inspecting the structure of the dataset, there are some obvious mistakes in classifying the data types of the variables. Some of the variables such as median house prices over specific periods should be stored as numerics instead of characters. Furthermore, certain variables such as suburb, LGA, postcode should be stored as factors as they can be deemed as data that can be categorised.

```{r}
# Converting the data structures of variables

# Storing supposed numeric columns as an object
numeric_cols <- c("Jul - Sep 19", "Oct - Dec 19", "Jan - Mar 20", "Apr- Jun 20", "Jul - Sep 20", "No of Sales YTD", "Change % Jul - Sep 19 Jul - Sep 20", "Change % Apr - Jun 20 Jul - Sep 20")

# Converting characters to numeric data types
house_medians_criminal_incidents[numeric_cols] <- sapply(house_medians_criminal_incidents[numeric_cols], as.numeric)

# Checking structure after conversion
house_medians_criminal_incidents %>% str()
```
```{r}
# Storing supposed factor columns as an object
fac_cols <- c("Suburb", "Local Government Area", "Postcode", "Year", "Year ending", "Offence Division", "Offence Subdivision", "Offence Subgroup")

# Converting characters to factors
house_medians_criminal_incidents[fac_cols] <- lapply(house_medians_criminal_incidents[fac_cols], as.factor)

# View structure
house_medians_criminal_incidents %>% str()
```
The output above displays the structure of the dataframe after conversion of various data types. Categorical variables are converted to factors to allow further analysis to be done on any given factor. There are no ordered factors. Numerical variables that are previously character variables are treated and converted to the numerical data type.

```{r}
# Rearranging variables within dataframe
house_medians_criminal_incidents <- house_medians_criminal_incidents[,c("Suburb", "Postcode", "Local Government Area", "Jul - Sep 19", "Oct - Dec 19", "Jan - Mar 20", "Apr- Jun 20", "Jul - Sep 20", "No of sales Jul - Sep 20", "No of Sales YTD", "Change % Jul - Sep 19 Jul - Sep 20", "Change % Apr - Jun 20 Jul - Sep 20", "Year", "Year ending", "Offence Division", "Offence Subdivision", "Offence Subgroup", "Incidents Recorded", "Charges laid", "No charges laid", "Unsolved")]

# View dataframe
house_medians_criminal_incidents %>% head()
```
```{r}
# Filtering rows
house_medians_criminal_incidents <- house_medians_criminal_incidents %>% filter(Year == "2020")

# Renaming column
names(house_medians_criminal_incidents)[names(house_medians_criminal_incidents) == "Year"] <- "Crime Year" 

# View dataframe
house_medians_criminal_incidents$`Crime Year` %>% unique()
```
The crime incidents dataset reports crime incidents for the year ending September 2020. Thus, the time frame for one year from October 2019 to September 2020. As the time frame of interest for this project is only for the year ending Sept 2020, the dataset is filtered to only display the crimes that are committed in the year 2020.

<br>
<br>

##	**Tidy & Manipulate Data I **
```{r}
# Display section of untidy data
house_medians_criminal_incidents %>% select("Charges laid", "No charges laid", "Unsolved")
```
The above output displays portion of the data that do not conform to the tidy data rules. "Charges laid", "No charges laid" and "Unsolved" are values of a variable, not a variable of its own. 

```{r}
# Transform data
house_medians_criminal_incidents <- house_medians_criminal_incidents %>% pivot_longer(names_to = "Charge Status", values_to = "No. of Incidents Recorded (LGA)", cols = c("Charges laid", "No charges laid", "Unsolved"))

# View transformed data
house_medians_criminal_incidents %>% select("Charge Status", "No. of Incidents Recorded (LGA)")
```
The pivot_longer() function was applied on the columns that required to be transformed from wide to long format. A variable name "Charge Status" was assigned to represent the values "Charges laid", "No charges laid" and "Unsolved". A "No. of Incidents Recorded (LGA)" variable was created to represent the number of recorded criminal incidents within any given LGA that were either charged, not charged or unsolved.

```{r}
# Display other section of data that requires tidying
house_medians_criminal_incidents %>% select("Jul - Sep 19", "Oct - Dec 19", "Jan - Mar 20", "Apr- Jun 20", "Jul - Sep 20")
```
The above output displays the median house prices of multiple quarters within the years 2019 and 2020. These quarters are stored as variables. However, they represent the values of annually quarters.

```{r}
# Transform data
house_medians_criminal_incidents <- house_medians_criminal_incidents %>% pivot_longer(names_to = "Quarter / Year", values_to = "Median Price", cols = c("Jul - Sep 19", "Oct - Dec 19", "Jan - Mar 20", "Apr- Jun 20", "Jul - Sep 20"))

# View transformed data
house_medians_criminal_incidents %>% select("Quarter / Year", "Median Price")
```
A variable name "Quarter / Year" was assigned to represent the values "Jul - Sep 19", "Oct - Dec 19", "Jan - Mar 20", "Apr- Jun 20", "Jul - Sep 20". A "Median Price" variable was created to show the median house price at any given quarter.

The "Quarter / Year" variable displays each quarter and their respective year within each cell. This shows two values within each cell across all cells within that variable. Therefore, this can be further improved by seperating the quarter and the year into different columns.

```{r}
# Replace months and years with appropriate names
house_medians_criminal_incidents$`Quarter / Year`[house_medians_criminal_incidents$`Quarter / Year` == "Jul - Sep 19"] <- "Q3 2019"
house_medians_criminal_incidents$`Quarter / Year`[house_medians_criminal_incidents$`Quarter / Year` == "Oct - Dec 19"] <- "Q4 2019"
house_medians_criminal_incidents$`Quarter / Year`[house_medians_criminal_incidents$`Quarter / Year` == "Jan - Mar 20"] <- "Q1 2020"
house_medians_criminal_incidents$`Quarter / Year`[house_medians_criminal_incidents$`Quarter / Year` == "Apr- Jun 20"] <- "Q2 2020"
house_medians_criminal_incidents$`Quarter / Year`[house_medians_criminal_incidents$`Quarter / Year` == "Jul - Sep 20"] <- "Q3 2020"

house_medians_criminal_incidents$`Quarter / Year` %>% unique()
```
Before separating the variables, the names of values of "Quarter / Year" are renamed to their respective quarters and years for improved clarity.

```{r}
# Separating Quarter and Year into different columns
house_medians_criminal_incidents <- house_medians_criminal_incidents %>% separate(`Quarter / Year`, into = c("Quarter", "Year"), sep = " ")
house_medians_criminal_incidents %>% select("Quarter", "Year")
```
Since multiple variables (months and year) are stored in one column, they are then split into two seperate columns. The months (Jan-Mar, Apr-Jun, Jul-Sep, Oct-Dec) could potentially be confusing so they are renamed to Q1, Q2, Q3 and Q4 respectively. Hence, these variables now have their own columns with values located in each cell.

```{r}
# Rearranging of variables
house_medians_criminal_incidents <- house_medians_criminal_incidents[,c("Suburb", "Postcode", "Local Government Area", "Quarter", "Year", "Median Price", "No of sales Jul - Sep 20", "No of Sales YTD", "Change % Jul - Sep 19 Jul - Sep 20", "Change % Apr - Jun 20 Jul - Sep 20", "Crime Year", "Year ending", "Offence Division", "Offence Subdivision", "Offence Subgroup", "Incidents Recorded", "Charge Status", "No. of Incidents Recorded (LGA)")]

# Rename column "Incidents Recorded"
names(house_medians_criminal_incidents)[names(house_medians_criminal_incidents) == "Incidents Recorded"] <- "Incidents Recorded (Suburb)"

# Excluding Q3 2019 of median house prices
house_medians_criminal_incidents <- house_medians_criminal_incidents %>% filter(!(Quarter == "Q3" & Year == 2019))

# View dataframe
house_medians_criminal_incidents %>% head()
```
The columns are rearranged for organisation and Q3 2019 of median house prices are exluded since the time frame of interest is Q4 2019 to Q3 2020.

```{r}
# Refactoring of newly created variables
house_medians_criminal_incidents %>% str()
```
<br>
<br>

## **Tidy & Manipulate Data II** 

```{r}
# This is the R chunk for the Tidy & Manipulate Data II 

```

Provide explanations here. 

<br>
<br>

##	**Scan I **

```{r}
# This is the R chunk for the Scan I

```

Provide explanations here. 

<br>
<br>

##	**Scan II**

```{r}
# This is the R chunk for the Scan II

```

Provide explanations here. 

<br>
<br>

##	**Transform **

```{r}
# This is the R chunk for the Transform Section

```

Provide explanations here. 



<br>
<br>

